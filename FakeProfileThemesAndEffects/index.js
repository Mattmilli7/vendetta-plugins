((e,t,r,o,n,i,l,a,s,c,f,d,u)=>{"use strict";var m=t.findByStoreName("CollectiblesPurchaseStore"),p=t.findByStoreName("ProfileEffectStore"),y=t.findByStoreName("UserProfileStore"),h=t.findByStoreName("UserStore"),E=o.FluxDispatcher,g=n.semanticColors,v=t.find((e=>e.default?.internal?.resolveSemanticColor))?.default.internal.resolveSemanticColor??t.find((e=>e.meta?.resolveSemanticColor))?.meta.resolveSemanticColor??(()=>{}),P=t.findByProps("useAvatarColors")?.useAvatarColors??(()=>{}),S=t.findByProps("getProfileTheme").getProfileTheme,b=t.findByProps("useThemeContext")?.useThemeContext??(()=>({})),C=t.findByProps("ThemeContextProvider")?.ThemeContextProvider??(e=>{var{children:t}=e;return t});function B(){E.dispatch({type:"USER_SETTINGS_ACCOUNT_SUBMIT_SUCCESS"})}var A=!0,I=null;function T(e){var[t,o]=r.useState((()=>I=e));return[t,e=>{o(I=e),A&&B()}]}var N,w=null;function _(e){var[t,o]=r.useState((()=>w=e));return[t,e=>{o(w=e),A&&B()}]}function F(e){N=e}var R=!1,x=t.findByName("useProfileTheme",!1)??(R=!0,t.findByName("useProfileThemeColors",!1))??{default(){}},D=String.fromCodePoint(8203),k=4096,z=917504,L=z+k-1;function H(e,t){return String.fromCodePoint(...[..."[#".concat(e.toString(16),",#").concat(t.toString(16),"]")].map((e=>e.codePointAt(0)+z)))}function U(e){var[t,r]=e.matchAll(/(?<=#)[\dA-Fa-f]{1,6}/g);return[t?parseInt(t[0],16):-1,r?parseInt(r[0],16):-1]}function V(e){if(0===e)return String.fromCodePoint(z);for(var t="";e>0;e=Math.trunc(e/k))t=String.fromCodePoint(e%k+z)+t;return t}function O(e){if(""===e)return-1;for(var t=0,r=0;r<e.length;r++){if(t>16777215)return-2;t+=e.codePointAt(r)*k**(e.length-1-r)}return t}function M(e){if(0n===e)return String.fromCodePoint(z);for(var t="";e>0n;e/=BigInt(k))t=String.fromCodePoint(Number(e%BigInt(k))+z)+t;return t}function G(e){if(""===e)return-1n;for(var t=0n,r=0;r<e.length;r++){if(t>=10000000000000000000n)return-2n;t+=BigInt(e.codePointAt(r))*BigInt(k)**BigInt(e.length-1-r)}return t}function W(e){var t=["","",""],r=0;for(var o of e){var n=o.codePointAt(0);if(8203===n){if(r>=2)break;r++}else if(z>n||n>L){if(r>0||""!==t[0])break}else t[r]+=String.fromCodePoint(n-z)}return t}function X(e,t,r){t>-1?(e.themeColors=[t,r>-1?r:t],e.premiumType=2):r>-1&&(e.themeColors=[r,r],e.premiumType=2)}function j(e,t){t>-1n&&(e.profileEffectId=e.profileEffectID=t.toString(),e.premiumType=2)}function K(e){return"function"==typeof e[Symbol.iterator]}function Y(e){return null!==e&&"object"==typeof e}function Z(e){return Y(e)&&"type"in e}function q(e){return"children"in e.props}function J(e){return"symbol"==typeof e?Symbol.keyFor(e)??null:"function"==typeof e?(e.displayName||e.name)??null:"_context"in e?e._context.displayName??null:e.displayName?e.displayName:"render"in e?(e.render.displayName||e.render.name)??null:"type"in e?J(e.type):null}function Q(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(Y(e))if(K(e)){if(r>0)for(var o of e){var n=Q(o,t,r-1);if(n)return n}}else{if(t(e))return e;if(q(e))return Q(e.props.children,t,r-1)}return null}function $(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(Y(e))if(K(e)){if(r>0)for(var o of e){var n=$(o,t,r-1);if(n)return n}}else if(q(e))return t(e.props.children)?e:$(e.props.children,t,r-1);return null}var ee,te=t.findByName("ProfileEffectRecord"),re=t.findByName("EditProfileEffectActionSheet"),oe=re?e=>{var{currentEffectId:t,effects:o,onSelect:n,user:l}=e,a=re({user:l}),s=b(),c=r.useMemo((()=>o.map((e=>({items:new te(e)})))),[o]);if(i.storage.forceFallbackEffectPicker)return r.createElement(Ee,e);var f=!1,d=Q(a,(e=>"EditProfileEffectInner"===J(e.type)||"profileEffects"in e.props&&"selectedProfileEffect"in e.props&&"function"==typeof e.props.setSelectedProfileEffect&&(f=!0)));if(!d)return ee||r.createElement(Ee,e);var u=Q(a,(e=>"Button"===J(e.type)));if(!u)return ee||r.createElement(Ee,e);if(f){void 0===d.props.selectedProfileEffect&&d.props.setSelectedProfileEffect(e.currentEffectId?{id:e.currentEffectId}:null),d.props.profileEffects=e.effects;var m=$(a,(e=>Array.isArray(e)&&e.some((e=>"DisplayBanner"===J(e.type)))));if(m){var p=a;m.props.children=r.createElement(C,{theme:p.props.theme,primaryColor:p.props.primaryColor,secondaryColor:p.props.secondaryColor,children:m.props.children}),p.props.theme=s.theme,p.props.primaryColor=s.primaryColor,p.props.secondaryColor=s.secondaryColor}}else void 0===d.props.selectedProfileEffect&&d.props.setSelectedProfileEffect(t?new te({id:t}):null),d.props.purchases=c;return F(l.id),u.props.onPress=()=>{F(void 0),n(o.find((e=>e.id===d.props.selectedProfileEffect?.id))?.config??null)},ee=a}:Ee,ne=t.findByProps("triggerHapticFeedback"),ie=ne?.HapticFeedbackTypes??{},le=ne?.triggerHapticFeedback??(()=>{}),ae=c.getAssetIDByName("img_none"),se=t.findByProps("DEFAULT_PROFILE_EFFECT_WH_RATIO")?.DEFAULT_PROFILE_EFFECT_WH_RATIO??45/88,ce=c.getAssetIDByName("sample-profile-small")??{uri:"https://discordapp.com/assets/f328a6f8209d4f1f5022.png"},fe=c.getAssetIDByName("toast_copy_link");c.getAssetIDByName("Small");var de=t.findByProps("Radius")?.Radius??{},ue=t.findByProps("Spacing")?.Spacing??{},me=t.findByProps("SafeAreaContext")?.SafeAreaContext,pe=t.findByName("useWindowDimensions")??(()=>{}),ye=3;function he(e){var{label:t,isSelected:o,size:n,colors:i,onPress:l,style:a,children:s}=e,[c,f,d]=i;return r.createElement(Me,{accessibilityLabel:t,accessibilityRole:"button",accessibilityState:{selected:o},disabled:o,onPress(){le(ie.IMPACT_LIGHT),l()},style:[{height:n,width:n,overflow:"hidden",backgroundColor:f,borderColor:c,borderRadius:de.sm,borderWidth:2},o&&{borderColor:d},a]},s)}function Ee(e){var{currentEffectId:t,effects:o,onSelect:n}=e,[i,l]=r.useState(t),[c,f]=r.useState(0),{theme:d}=b(),u=r.useMemo((()=>[v(d,g.BACKGROUND_PRIMARY),v(d,g.BACKGROUND_FLOATING),v(d,g.BUTTON_OUTLINE_BRAND_BORDER_ACTIVE)]),[d]),m=pe(),p=r.useContext(me),y=r.useMemo((()=>{for(var e=s.chunk([null,...o],ye),t=e[e.length-1];3>t.length;)t.push(void 0);return e}),[o]);return r.createElement(Se,{transparentHeader:!0,scrollable:!0,startExpanded:!0,startHeight:m.height-p.top},r.createElement(be,{scrollsToTop:!1},r.createElement(a.View,{style:{flex:1,flexDirection:"column",alignItems:"center",paddingBottom:88}},r.createElement(Le,{variant:"redesign/heading-18/bold",color:"header-primary",style:{margin:ue.PX_16}},t?"Change Effect":"Add Profile Effect"),r.createElement(a.View,{style:{width:"72%",minHeight:38}},r.createElement(Le,{variant:"heading-md/bold",color:"header-primary",style:{textAlign:"center"}},o.find((e=>e.id===i))?.config.title??"None")),r.createElement(a.View,{style:{flex:1,width:"92%",marginTop:3}},r.createElement(He,{accessibilityLabel:"Profile Effect Selection Section",numColumns:1,estimatedItemSize:98,ItemSeparatorComponent:()=>r.createElement(a.View,{style:{height:ue.PX_16}}),contentContainerStyle:{paddingHorizontal:ue.PX_4},data:y,extraData:i,renderItem(e){var{item:t}=e;return r.createElement(a.View,{style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:ue.PX_16}},t.map((e=>e?r.createElement(he,{label:e.config.accessibilityLabel,isSelected:e.id===i,size:c,colors:u,onPress(){l(e.id)}},r.createElement(ze,{effect:e.config})):null===e?r.createElement(he,{label:"None",isSelected:!i,size:c,colors:u,onPress(){l(void 0)},style:{alignItems:"center",justifyContent:"center"}},r.createElement(ke,{source:ae,size:ke.Sizes.LARGE}),r.createElement(Le,{variant:"text-sm/medium",color:"header-primary",style:{marginTop:ue.PX_4}},"None")):r.createElement(a.View,{style:{width:c,height:c}}))))},onLayout(e){f((e.nativeEvent.layout.width-64)/ye)}})))),r.createElement(De,{text:"Apply",textStyle:{fontSize:16},onPress(){n(o.find((e=>e.id===i))?.config??null)},style:{position:"absolute",right:0,bottom:0,left:0,height:48,marginHorizontal:36,marginBottom:ue.PX_48,borderRadius:de.round}}))}var ge=t.findByName("showCustomColorPickerActionSheet")??(()=>{});function ve(e){var t;return(t=e).color??(t.color=0),ge(e)}var Pe="__FPTE__",Se=t.findByProps("BottomSheet")?.BottomSheet??t.findByProps("ActionSheet")?.ActionSheet??(()=>{throw Error("FakeProfileThemesAndEffects threw an error to avoid an otherwise-inevitable, unrecoverable freeze.")}),be=t.findByProps("BottomSheetScrollView")?.BottomSheetScrollView??(()=>null),Ce=t.findByProps("showActionSheet"),Be=Ce?.showActionSheet??(()=>{}),Ae=Ce?.default?.hideActionSheet??(()=>{}),Ie=f.Forms.FormSection,Te=f.Forms.FormRow,Ne=f.Forms.FormRadioRow,we=f.Forms.FormSwitchRow,_e=f.Forms.FormCardSection;function Fe(e){var{guildId:t}=e,[o,n]=T(null),[i,s]=_(null),[c,f]=r.useState(null),[u,m]=(e=>{var[t,o]=r.useState((()=>A=!0));return[t,e=>{o(A=e),B()}]})(),[y,S]=r.useState(!1),{theme:C}=b(),[I,N]=r.useMemo((()=>[v(C,g.HEADER_SECONDARY),v(C,g.BACKGROUND_ACCENT)]),[C]),w=P(h.getCurrentUser().getAvatarURL(t,80),N,!1);return r.createElement(_e,{title:"FPTE Builder",cardStyle:{backgroundColor:"transparent"}},r.createElement(a.View,{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},r.createElement(xe,{fgColor:I,label:"Primary",bgColor:o,onPress(){ve({color:o,onSelect:n,suggestedColors:w})}}),r.createElement(xe,{fgColor:I,label:"Accent",bgColor:i,onPress(){ve({color:i,onSelect:s,suggestedColors:w})}}),r.createElement(xe,{fgColor:I,label:"Effect",onPress(){var e,t;e=f,t=c?.id,E.subscribe("HIDE_ACTION_SHEET",(function e(t){t.key===Pe&&(E.unsubscribe("HIDE_ACTION_SHEET",e),F(void 0))})),Be({content:r.createElement(oe,{effects:p.profileEffects,onSelect(t){e(t),Ae(Pe)},user:h.getCurrentUser(),currentEffectId:t}),key:Pe})}},c&&r.createElement(ze,{effect:c,style:{width:"100%",height:"100%"}})),r.createElement(a.View,{style:{display:"flex",alignItems:"center",flexDirection:"column"}},r.createElement(De,{text:"Copy FPTE",size:De.Sizes.SMALL,onPress(){var e,t=((e,t,r,o)=>{var n="";if(o){if(e>=0)return n=H(e,0>t?e:t),""!==r&&(n+=D+M(BigInt(r))),n;if(t>=0)return n=H(t,t),""!==r&&(n+=D+M(BigInt(r))),n}else if(0>e)0>t||(n=V(t));else if(n=V(e),t>=0&&e!==t)return n+=D+V(t),""!==r&&(n+=D+M(BigInt(r))),n;return""!==r&&(n+=D+D+M(BigInt(r))),n})(o??-1,i??-1,c?.id??"",y);t?(e=t,d.setString(e),l.showToast("FPTE copied to clipboard!",fe)):l.showToast("FPTE Builder is empty; nothing to copy!")}}),r.createElement(De,{text:"Reset",look:De.Looks.LINK,color:De.Colors.TRANSPARENT,size:De.Sizes.SMALL,...null===o&&null===i&&!c&&{pointerEvents:"none",style:{opacity:0}},onPress(){n(null),s(null),f(null)}}))),r.createElement(we,{label:"FPTE Builder Preview",value:u,onValueChange:m}),r.createElement(we,{label:"Build backwards compatible FPTE",subLabel:"Will use more characters",value:y,onValueChange:S}))}var Re,xe=e=>{var{label:t,fgColor:o,bgColor:n,onPress:i,children:l}=e;return r.createElement(a.View,{style:{width:50}},r.createElement(Me,{accessibilityLabel:t,accessibilityRole:"button",onPress:i,style:[{display:"flex",alignItems:"center",justifyContent:"center",height:50,overflow:"hidden",borderColor:o,borderStyle:"dashed",borderWidth:2,borderRadius:de.xs},null!=n&&{backgroundColor:"#"+n.toString(16).padStart(6,"0"),borderStyle:"solid"},!!l&&{borderWidth:0}]},l??(null==n&&r.createElement(Ve,{fill:o,width:"40%",height:"40%",viewBox:"0 0 144 144"},r.createElement(Oe,{d:"M144 64H80V0H64v64H0v16h64v64h16V80h64Z"})))),!!t&&r.createElement(Le,{variant:"text-sm/normal",style:{marginTop:ue.PX_4,textAlign:"center"}},t))},De=f.Button,ke=t.findByProps("IconSizes")?.default??(()=>null),ze=e=>{var{effect:t,style:o}=e;return r.createElement(a.View,{style:o},r.createElement(a.Image,{resizeMode:"cover",source:ce,style:{width:"100%",height:"100%"}}),r.createElement(a.Image,{alt:t.accessibilityLabel,resizeMethod:"resize",resizeMode:"cover",source:{uri:t.thumbnailPreviewSrc},style:{position:"absolute",width:"100%",aspectRatio:se}}))},Le=t.findByProps("TextStyleSheet")?.Text??(()=>null),He=t.findByName("FlashList")??(()=>null),Ue=t.findByProps("Svg"),Ve=Ue?.Svg??(()=>null),Oe=Ue?.Path??(()=>null),Me=t.findByProps("PressableOpacity")?.PressableOpacity??(()=>null),Ge=t.findByName("GuildProfileEditForm",!1),We=t.findByPropsAll("NONE_ITEM"),Xe=t.findByName("UserProfileEditForm",!1),je=[];return{onLoad(){je.push(e.instead("getPurchase",m,((e,t)=>N?{purchasedAt:new Date}:t(e))),e.after("getUserProfile",y,((e,t)=>{if(void 0===t)return t;if(i.storage.prioritizeNitro){if(void 0!==t.themeColors){if(void 0===t.profileEffectId&&void 0===t.profileEffectID){var r=W(t.bio);-2===O(r[0])?j(t,G(r[1])):j(t,G(r[2]))}return t}if(void 0!==t.profileEffectId||void 0!==t.profileEffectID){var o=W(t.bio),n=O(o[0]);return-2===n?X(t,...U(o[0])):X(t,n,O(o[1])),t}}var l=W(t.bio),a=O(l[0]);return-2===a?(X(t,...U(l[0])),j(t,G(l[1]))):(X(t,a,O(l[1])),j(t,G(l[2]))),t})),e.after("default",Ge,((e,t)=>{if(i.storage.hideBuilder)return t;var o,n=$(t,(e=>Array.isArray(e)&&e.some((e=>!(!Z(e)||"EditGuildIdentityBio"!==J(e.type)||(o=e.props.displayProfile?.guildId,0))))));return n&&n.props.children.splice(2,0,r.createElement(Fe,{guildId:o})),t})),...We.map((t=>e.after("default",t,((e,t)=>(N&&(void 0!==p.profileEffects?(t.splice(1),t[0].items.splice(1),p.profileEffects.forEach((e=>{t[0].items.push(new te(e))})),Re=t):t=Re),t))))),e.after("default",x,R?(e,t)=>{var[r,o,n]=e;if((null!=r&&r.id===N||n)&&A){if(null!==I)return[I,w??I];if(null!==w)return[w,w]}return t}:(e,t)=>{var[r]=e,{user:o}=r;return(null!=o&&o.id===N||"pendingThemeColors"in r)&&A&&(null!==I?(t.theme=S(I),t.primaryColor=I,t.secondaryColor=w??I):null!==w&&(t.theme=S(w),t.primaryColor=w,t.secondaryColor=w)),t}),e.after("default",Xe,((e,t)=>{if(i.storage.hideBuilder)return t;var o=$(t,(e=>Array.isArray(e)&&e.some((e=>Z(e)&&"EditUserProfileBio"===J(e.type)))));return o&&o.props.children.splice(2,0,r.createElement(Fe,null)),t})))},onUnload(){je.forEach((e=>{e()}))},settings:()=>(u.useProxy(i.storage),r.createElement(a.ScrollView,null,r.createElement(Ie,{title:"Settings"},r.createElement(Te,{label:"Source to prioritize"}),r.createElement(Ne,{label:"Nitro",selected:!!i.storage.prioritizeNitro,onPress(){i.storage.prioritizeNitro=!0}}),r.createElement(Ne,{label:"About Me",selected:!i.storage.prioritizeNitro,onPress(){i.storage.prioritizeNitro=!1}}),r.createElement(we,{label:"Hide Builder",subLabel:"Hide the FPTE Builder in the User Profile and Server Profiles settings pages",value:!!i.storage.hideBuilder,onValueChange(e){i.storage.hideBuilder=e}}),r.createElement(we,{label:"Force fallback effect picker",value:!!i.storage.forceFallbackEffectPicker,onValueChange(e){i.storage.forceFallbackEffectPicker=e}}))))}})(vendetta.patcher,vendetta.metro,React,vendetta.metro.common,vendetta.ui,vendetta.plugin,vendetta.ui.toasts,vendetta.metro.common.ReactNative,vendetta.metro.common.lodash,vendetta.ui.assets,vendetta.ui.components,vendetta.metro.common.clipboard,vendetta.storage);
