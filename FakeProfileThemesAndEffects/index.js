(function(F,S,h,f,u,N,x,se,s,de){"use strict";function U(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ye(e){if(Array.isArray(e))return U(e)}function pe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ve(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function W(e){return ye(e)||pe(e)||he(e)||ve()}function he(e,r){if(e){if(typeof e=="string")return U(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(t);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return U(e,r)}}function $(e,r){var t;return(t=String).fromCodePoint.apply(t,W(W("[#".concat(e.toString(16),",#").concat(r.toString(16),"]")).map(function(n){return n.codePointAt(0)+917504})))}function G(e){var r=e.matchAll(RegExp("(?<=#)[\\dA-Fa-f]{1,6}","g"));return[parseInt(r.next().value?.[0],16)||-1,parseInt(r.next().value?.[0],16)||-1]}function L(e){if(e===0)return"\u{E0000}";for(var r="";e>0;e=Math.trunc(e/4096))r=String.fromCodePoint(e%4096+917504)+r;return r}function m(e){if(e==="")return-1;for(var r=0,t=0;t<e.length;t++){if(r>16777215)return-2;r+=e.codePointAt(t)*4096**(e.length-1-t)}return r}function C(e){if(e===0n)return"\u{E0000}";for(var r="";e>0n;e/=4096n)r=String.fromCodePoint(Number(e%4096n)+917504)+r;return r}function P(e){if(e==="")return-1n;for(var r=0n,t=0;t<e.length;t++){if(r>1200000000000000000n)return-2n;r+=BigInt(e.codePointAt(t))*4096n**BigInt(e.length-1-t)}return r}function me(e,r,t,n){var i="\u200B",o="";if(n){if(e!==-1)return r!==-1?o=$(e,r):o=$(e,e),t!==""&&(o+=i+C(BigInt(t))),o;if(r!==-1)return o=$(r,r),t!==""&&(o+=i+C(BigInt(t))),o}else if(e!==-1){if(o=L(e),r!==-1&&e!==r)return o+=i+L(r),t!==""&&(o+=i+C(BigInt(t))),o}else r!==-1&&(o=L(r));return t!==""&&(o+=i+i+C(BigInt(t))),o}function O(e){var r=["","",""],t=0,n=!0,i=!1,o=void 0;try{for(var a=e[Symbol.iterator](),l;!(n=(l=a.next()).done);n=!0){var d=l.value,y=d.codePointAt(0);if(y===8203){if(t>=2)break;t++}else if(y>=917504&&y<=921599)r[t]+=String.fromCodePoint(y-917504);else if(t>0||r[0]!=="")break}}catch(p){i=!0,o=p}finally{try{!n&&a.return!=null&&a.return()}finally{if(i)throw o}}return r}var ge=f.findByStoreName("UserProfileStore");function D(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ee(e){if(Array.isArray(e))return D(e)}function be(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Se(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function q(e){return Ee(e)||be(e)||Ce(e)||Se()}function Ce(e,r){if(e){if(typeof e=="string")return D(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(t);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return D(e,r)}}function A(e,r,t){r>-1?(e.themeColors=[r,t>-1?t:r],e.premiumType=2):t>-1&&(e.themeColors=[t,t],e.premiumType=2)}function R(e,r){r>-1n&&(e.profileEffectId=e.profileEffectID=r.toString(),e.premiumType=2)}function Pe(){return S.after("getUserProfile",ge,function(e,r){if(r===void 0)return r;if(h.storage.prioritizeNitro){if(r.themeColors!==void 0){if(r.profileEffectId===void 0&&r.profileEffectID===void 0){var t=O(r.bio);m(t[0])===-2?R(r,P(t[1])):R(r,P(t[2]))}return r}else if(r.profileEffectId!==void 0||r.profileEffectID!==void 0){var n=O(r.bio),i=m(n[0]);return i===-2?A.apply(void 0,[r].concat(q(G(n[0])))):A(r,i,m(n[1])),r}}var o=O(r.bio),a=m(o[0]);return a===-2?(A.apply(void 0,[r].concat(q(G(o[0])))),R(r,P(o[1]))):(A(r,a,m(o[1])),R(r,P(o[2]))),r})}function J(e){return typeof e[Symbol.iterator]=="function"}function w(e){return e!==null&&typeof e=="object"}function K(e){return w(e)&&"type"in e}function Q(e){return"children"in e.props}function Ae(e){return"_context"in e}function Re(e){return"render"in e}function we(e){return"type"in e}function g(e){return typeof e=="function"?e.displayName||e.name||null:Ae(e)?e._context.displayName||null:e.displayName?e.displayName:Re(e)?e.render.displayName||e.render.name||null:we(e)?g(e.type):null}function T(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200;if(w(e))if(J(e)){if(t>0){var n=!0,i=!1,o=void 0;try{for(var a=e[Symbol.iterator](),l;!(n=(l=a.next()).done);n=!0){var d=l.value,y=T(d,r,t-1);if(y)return y}}catch(p){i=!0,o=p}finally{try{!n&&a.return!=null&&a.return()}finally{if(i)throw o}}}}else{if(r(e))return e;if(Q(e))return T(e.props.children,r,t-1)}return null}function _(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200;if(w(e)){if(J(e)){if(t>0){var n=!0,i=!1,o=void 0;try{for(var a=e[Symbol.iterator](),l;!(n=(l=a.next()).done);n=!0){var d=l.value,y=_(d,r,t-1);if(y)return y}}catch(p){i=!0,o=p}finally{try{!n&&a.return!=null&&a.return()}finally{if(i)throw o}}}}else if(Q(e))return r(e.props.children)?e:_(e.props.children,r,t-1)}return null}var M=f.findByStoreName("UserStore"),Te=f.findByName("useProfileThemeColors",!1),_e=M.getCurrentUser().id,c={primaryColor:-1,accentColor:-1,showPreview:!0};function Ie(){return S.after("default",Te,function(e,r){if(e?.[0]?.id===_e&&(w(e[2])&&"pendingThemeColors"in e[2]||e[0].__FPTE__)&&c.showPreview){if(c.primaryColor>-1)return[c.primaryColor,c.accentColor>-1?c.accentColor:c.primaryColor];if(c.accentColor>-1)return[c.accentColor,c.accentColor]}return r})}var X=f.findByName("showCustomColorPickerActionSheet")??function(){},Be="/user-profile-effects",Y=f.findByName("ProfileEffectRecord"),Fe=f.findByProps("getAPIBaseURL"),Ne=f.findByName("EditProfileEffectActionSheet")??function(){return null};function xe(e){var r=e.effects,t=e.onSelect,n=e.user,i=e.currentEffect,o=Ne({user:n}),a=T(o,function(d){return g(d.type)==="EditProfileEffectInner"});if(!a)return null;a.props.selectedProfileEffect===void 0&&a.props.setSelectedProfileEffect(i??null);var l=T(o,function(d){return g(d.type)==="Button"});return l?(a.props.purchases=r,a.props.user.__FPTE__=!0,l.props.onPress=function(){delete a.props.user.__FPTE__,t(a.props.selectedProfileEffect)},o):null}var Ue=N.getAssetIDByName("toast_copy_link"),$e=N.getAssetIDByName("Small");function Le(e,r){u.clipboard.setString(e),x.showToast(r,Ue)}function Oe(e){x.showToast(e,$e)}var j="__FPTE__";function De(e,r){Fe.get({url:Be}).then(function(t){var n=t.body.profile_effect_configs,i=M.getCurrentUser(),o=function(a){a.key===j&&(u.FluxDispatcher.unsubscribe("HIDE_ACTION_SHEET",o),delete i.__FPTE__)};u.FluxDispatcher.subscribe("HIDE_ACTION_SHEET",o),Me({content:React.createElement(xe,{effects:n.map(function(a){return{items:new Y({id:a.id})}}),onSelect:function(a){e(a&&n.find(function(l){return l.id===a.id})),je(j)},user:i,currentEffect:r?new Y({id:r}):null}),key:j})}).catch(function(t){console.error(t),console.log(t.stack),Oe("Unable to setup the effect picker.")})}var Z=f.findByProps("showActionSheet"),Me=Z?.showActionSheet??function(){},je=Z?.default?.hideActionSheet??function(){},ke=se.semanticColors,ze=f.findByProps("colors","meta")?.meta?.resolveSemanticColor??function(){},He=f.findByProps("useAvatarColors")?.useAvatarColors??function(){};function k(e){var r=e.fgColor,t=e.label,n=e.bgColor,i=e.children,o=e.onPress;return React.createElement(H,{style:{width:50}},React.createElement(Xe,{accessibilityLabel:t,accessibilityRole:"button",onPress:o,...i&&{style:{height:50,overflow:"hidden",borderRadius:4},children:i}||n!==void 0&&{style:{height:50,backgroundColor:"#"+n.toString(16).padStart(6,"0"),borderColor:r,borderStyle:"solid",borderWidth:2,borderRadius:4}}||{style:{display:"flex",alignItems:"center",justifyContent:"center",height:50,borderColor:r,borderStyle:"dashed",borderWidth:2,borderRadius:4},children:React.createElement(Ke,{fill:r,width:"40%",height:"40%",viewBox:"0 0 144 144"},React.createElement(Qe,{d:"M144 64H80V0H64v64H0v16h64v64h16V80h64Z"}))}}),!!t&&React.createElement(qe,{variant:"text-sm/normal",style:{marginTop:4,textAlign:"center"}},t))}var Ve=s.Forms.FormSection,We=s.Forms.FormRow,ee=s.Forms.FormRadioRow,z=s.Forms.FormSwitchRow,Ge=s.Forms.FormCardSection,qe=f.findByProps("TextStyleSheet")?.Text??function(){return null},re=s.General.Image,Je=s.General.ScrollView,H=s.General.View,te=f.findByProps("Svg"),Ke=te?.Svg??function(){return null},Qe=te?.Path??function(){return null},Xe=f.findByProps("PressableOpacity")?.PressableOpacity??function(){return null};function ne(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ye(e){if(Array.isArray(e))return e}function Ze(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,o=!1,a,l;try{for(t=t.call(e);!(i=(a=t.next()).done)&&(n.push(a.value),!(r&&n.length===r));i=!0);}catch(d){o=!0,l=d}finally{try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}return n}}function er(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function E(e,r){return Ye(e)||Ze(e,r)||rr(e,r)||er()}function rr(e,r){if(e){if(typeof e=="string")return ne(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(t);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ne(e,r)}}var tr=u.React.useEffect,nr=u.React.useMemo,b=u.React.useState,or=N.getAssetIDByName("sample-profile-small"),ir=f.findByProps("DEFAULT_PROFILE_EFFECT_WH_RATIO")?.DEFAULT_PROFILE_EFFECT_WH_RATIO;function I(){u.FluxDispatcher.dispatch({type:"USER_SETTINGS_ACCOUNT_SUBMIT_SUCCESS"})}function oe(e){var r=e.theme,t=e.guildId,n=E(b(-1),2),i=n[0],o=n[1],a=E(b(-1),2),l=a[0],d=a[1],y=E(b(null),2),p=y[0],ae=y[1],le=E(b(!0),2),B=le[0],dr=le[1],ue=E(b(!1),2),ce=ue[0],yr=ue[1],fe=He(M.getCurrentUser().getAvatarURL(t,80),"#41434a",!1),V=nr(function(){return ze(r??"dark",ke.HEADER_SECONDARY)},[r]);return tr(function(){return function(){c.primaryColor=-1,c.accentColor=-1,c.showPreview=!0}},[]),u.React.createElement(Ge,{title:"FPTE Builder",cardStyle:{backgroundColor:"transparent"}},u.React.createElement(H,{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},u.React.createElement(k,{fgColor:V,label:"Primary",bgColor:i!==-1?i:void 0,onPress:function(){X({color:i!==-1?i:0,onSelect:function(v){o(c.primaryColor=v),B&&I()},suggestedColors:fe})}}),u.React.createElement(k,{fgColor:V,label:"Accent",bgColor:l!==-1?l:void 0,onPress:function(){X({color:l!==-1?l:0,onSelect:function(v){d(c.accentColor=v),B&&I()},suggestedColors:fe})}}),u.React.createElement(k,{fgColor:V,label:"Effect",onPress:function(){return De(function(v){return ae(v)},p?.id)}},p&&[u.React.createElement(re,{resizeMode:"cover",source:or,style:{width:"100%",height:"100%"}}),u.React.createElement(re,{alt:p.accessibilityLabel,resizeMethod:"resize",resizeMode:"cover",source:{uri:p.thumbnailPreviewSrc},style:{position:"absolute",width:"100%",aspectRatio:ir}})]),u.React.createElement(H,{style:{display:"flex",alignItems:"center",flexDirection:"column"}},u.React.createElement(s.Button,{text:"Copy FPTE",size:s.Button.Sizes.SMALL,onPress:function(){var v=me(i,l,p?.id??"",ce);v?Le(v,"FPTE copied to clipboard!"):x.showToast("FPTE Builder is empty; nothing to copy!")}}),u.React.createElement(s.Button,{text:"Reset",look:s.Button.Looks.LINK,color:s.Button.Colors.TRANSPARENT,size:s.Button.Sizes.SMALL,...i===-1&&l===-1&&!p&&{pointerEvents:"none",style:{opacity:0}},onPress:function(){o(c.primaryColor=-1),d(c.accentColor=-1),ae(null),B&&I()}}))),u.React.createElement(z,{label:"FPTE Builder Preview",value:B,onValueChange:function(v){dr(c.showPreview=v),I()}}),u.React.createElement(z,{label:"Build backwards compatible FPTE",subLabel:"Will use more characters",value:ce,onValueChange:function(v){return yr(v)}}))}var ar=f.findByName("GuildProfileEditForm",!1);function lr(){return S.after("default",ar,function(e,r){if(h.storage.hideBuilder)return r;var t,n=_(r,function(i){return Array.isArray(i)&&i.some(function(o){return K(o)&&g(o.type)==="EditGuildIdentityBio"?(t=o.props.displayProfile?.guildId,!0):!1})});return n&&n.props.children.splice(2,0,React.createElement(oe,{theme:n.props.theme,guildId:t})),r})}var ur=f.findByName("UserProfileEditForm",!1);function cr(){return S.after("default",ur,function(e,r){if(h.storage.hideBuilder)return r;var t=_(r,function(n){return Array.isArray(n)&&n.some(function(i){return K(i)&&g(i.type)==="EditUserProfileBio"})});return t&&t.props.children.splice(2,0,React.createElement(oe,{theme:t.props.theme})),r})}function fr(){return de.useProxy(h.storage),React.createElement(Je,null,React.createElement(Ve,{title:"Settings"},React.createElement(We,{label:"Source to prioritize"}),React.createElement(ee,{label:"Nitro",selected:!!h.storage.prioritizeNitro,onPress:function(){h.storage.prioritizeNitro=!0}}),React.createElement(ee,{label:"About Me",selected:!h.storage.prioritizeNitro,onPress:function(){h.storage.prioritizeNitro=!1}}),React.createElement(z,{label:"Hide Builder",subLabel:"Hide the FPTE Builder in the User Profile and Server Profile settings pages",value:!!h.storage.hideBuilder,onValueChange:function(e){h.storage.hideBuilder=e}})))}var ie=[],sr={onLoad:function(){ie.push(Pe(),Ie(),cr(),lr())},onUnload:function(){return ie.forEach(function(e){e()})},settings:fr};return F.default=sr,Object.defineProperty(F,"__esModule",{value:!0}),F})({},vendetta.patcher,vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui,vendetta.ui.components,vendetta.storage);
